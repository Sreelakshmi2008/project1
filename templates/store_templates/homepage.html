{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <link rel="shortcut icon" href="#">
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Eflyer</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
      <!-- Font Icon -->
      <link rel="stylesheet" href="{% static 'signup/fonts/material-icon/css/material-design-iconic-font.min.css' %}">
  
      <!-- signup form css -->
      <link rel="stylesheet" href="{% static 'signup/css/style.css' %}">
      <!-- bootstrap css -->
      <link rel="stylesheet" type="text/css" href="{% static 'homepage/css/bootstrap.min.css' %}">
      <!-- style css -->
      <link rel="stylesheet" type="text/css" href="{% static 'homepage/css/style.css' %}">
      <!-- Responsive-->
      <link rel="stylesheet" href="{% static 'homepage/css/responsive.css' %}">
      <!-- fevicon -->
      <link rel="icon" href="{% static 'homepage/images/fevicon.png' %}" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="{% static 'homepage/css/jquery.mCustomScrollbar.min.css' %}">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <!-- fonts -->
      <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
      <!-- font awesome -->
      <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <!--  -->
      <!-- owl stylesheets -->
      <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext" rel="stylesheet">
      <link rel="stylesheet" href="{% static 'homepage/css/owl.carousel.min.css' %}">
      <link rel="stylesheet" href="{% static 'homepage/css/owl.theme.default.min.css'%}">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">


      <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">


    
      
     
<!-- razorpay js -->

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>



      <style>
               /* Styling for the pop-up overlay */
            .overlay {
               display: none;
               position: fixed;
               top: 0;
               left: 0;
               width: 100%;
               height: 100%;
               background-color: rgba(0, 0, 0, 0.5); /* semi-transparent black */
               z-index: 9999; /* ensures the overlay is on top of other elements */
            }

            /* Styling for the pop-up content */
            .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            padding: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            text-align: center;
            z-index: 10000; /* ensures the pop-up is on top of the overlay */
            }

   
            #img-container{
               z-index: 1;
               max-width: 600px;
               position: relative;
               display:flex;
               justify-content: center;
               align-items: center;
               border: solid 1px #e8e8e8;
               box-shadow: 0px 1px 5px rgba(0,0,0,0.1);
           }
           
           #lens{
               z-index: 2;
               position: absolute;
           
               height: 400px;
               width: 400px;
               border:2px solid black;
               background-repeat: no-repeat;
               cursor: none;
           
           }
           
      
      </style>


   </head>
   <body>
      
      <!-- banner bg main start -->
      <div class="banner_bg_main">
         
        
         <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
               <a class="navbar-brand" href="{% url 'homepage' %}">
                <img src="{% static 'homepage\images\White logo - no background3.png' %}" class="img-fluid" style="height:60px">
               </a>

                <!-- search bar starts -->
             
              
                  <form method="post" action="{% url 'search_product' %}">
                     {% csrf_token %}
                  <div class="input-group">
                  <input type="text" class="form-control" id="query" name="query" placeholder="Search Products">
                  <div class="input-group-prepend">
                     <button class="input-group-text" id="basic-addon1" type="submit"><i class="fa fa-search"></i></button>
                   </div>
                  </div>
                  </form>
                 
             

               <!-- search bar starts -->
            </div>
               
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>


             

              <div class="col-sm-8 float-left">
               <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                     <button class="btn btn-secondary dropdown-toggle mr-2" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">All Category 
                     </button>
                     <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        {% for sub in sub %}
                        <a class="dropdown-item" href="{% url 'subcategory_filtering' sub.id %}">{{sub.name}}</a>
                        {% endfor %}
                        <!-- <a class="dropdown-item" href="#">Ladies pants</a>
                        <a class="dropdown-item" href="#">Gents pants</a>
                        <a class="dropdown-item" href="#">Gents pants</a> -->
                     </div>
                  
                  <a class="nav-link active mr-2" href="{% url 'menscollection' %}">Mens Collection</a>

                  <a class="nav-link active mr-2" href="{% url 'womencollection' %}">Ladies collection</a>
                  
                  <a class="nav-link active mr-2" href="{% url 'user_wishlist' %}">WishList</a>
                  
                  <a href="{% url 'cart' %}" class="mr-3 pt-1">
                     <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                     <span class="padding_5">Cart</span></a>
               
                  {% if user.is_authenticated %}
                  <a href="{% url 'userprofile' %}" class="nav-link active mr-3">Hi,{{user.name}}</a>
                  <a href="{% url 'signout' %}" class="nav-link active mr-3">Signout</a>
                  
                  {% else %}
                  <button class="btn btn-secondary mr-3">
                     <a href="{% url 'signup' %}" style="color: white;">Register |</a>
                     <a href="{% url 'signin' %}" style="color: white;">Signin</a>
                  </button>
                  {% endif %}
                 
                </div>
               </div>
              </div>
              
          </nav>
        {% block content %}
       
      </div>
      <!-- banner bg main end -->
      <div class="container mt-5 pt-5">
         <div class="row align-items-center">
           <div class="col-6">
             <img src="{% static 'homepage\images\Untitled.jpg' %}" class="" alt="Circular Image">
           </div>
           <div class="col mb-5" style="right: 60px;">
             <p class="text-dark" style="font-size: 50px; line-height: 70px;font-family:Georgia, 'Times New Roman', Times, serif;">Your choice,is always an exception</p>
           </div>
         </div>
      </div>


      <!-- fashion section start -->
      <div class="fashion_section">
         <h1 class="fashion_taital pt-5">New Collections</h1>
         <div id="main_slider" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
               <div class="carousel-item active">
                  <div class="container">
                     <div class="fashion_section_2">
                        <div class="row">
                           {% for product in product %}
                           
                           <div class="col-lg-4 col-sm-4">
                              <div class="box_main">
                                 <h4 class="shirt_text">{{product.name}}</h4>
                                 {% comment %} <h4 class="shirt_text">{{product.description}}</h4> {% endcomment %}
                                 <p class="price_text"><span style="color: #262626;">â‚¹{{product.productvariant.first.price}}</span></p>
                                 <div class="tshirt_img">
                                    <a href="{% url 'product_details'  product.id %}">
                                    <img src="{{ product.productcolor.first.color_image.url }}" alt="not working" >
                                    </a>
                                 </div>
                                 <div class="btn_main">
                                    <div class="buy_bt"><a href="{% url 'addToWishlist' product.id %}">Add to Wishlist</a></div>
                                    <div class="seemore_bt"><a href="{% url 'product_details' product.id %}">See More</a></div>
                                 </div>
                              </div>
                           </div>
                           {% endfor %}
                        </div>
                     </div>
                  </div>
               </div>
            </div>
            {% comment %} <a class="carousel-control-prev" href="#main_slider" role="button" data-slide="prev">
            <i class="fa fa-angle-left"></i>
            </a>
            <a class="carousel-control-next" href="#main_slider" role="button" data-slide="next">
            <i class="fa fa-angle-right"></i>
            </a> {% endcomment %}
         </div>
      </div>
      <!-- fashion section end -->
    
{% endblock content %}



      <!-- footer section start -->
   
      <div class="footer_section layout_padding mt-5">
        
            <div class="footer_menu">
               <ul>
                  <li><a href="#">Best Sellers</a></li>
                  <li><a href="#">Gift Ideas</a></li>
                  <li><a href="#">New Releases</a></li>
                  <li><a href="#">Today's Deals</a></li>
                  <li><a href="#">Customer Service</a></li>
               </ul>
            </div>
            <div class="location_main">Help Line  Number : <a href="#">+1 1800 1200 1200</a></div>
         
      </div>
      <!-- footer section end -->


      <!-- copyright section start -->
      <div class="copyright_section mb-0">
         <div class="container">
            <p class="copyright_text">Â© 2023 All Rights Reserved. </p>
         </div>
      </div>
      <!-- copyright section end -->



      <!-- Javascript files-->

      <!-- zoom -->
      <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    

      <script src="{% static 'homepage/js/jquery.min.js' %}"></script>
      <script src="{% static 'homepage/js/popper.min.js' %}"></script>
      <script src="{% static 'homepage/js/bootstrap.bundle.min.js' %}"></script>
      <script src="{% static 'homepage/js/jquery-3.0.0.min.js' %}"></script>
      <script src="{% static 'homepage/js/plugin.js' %}"></script>

      <!-- sidebar -->
      <script src="{% static 'homepage/js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
      <script src="{% static 'homepage/js/custom.js' %}"></script>



      <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
      <script>
          var availableTags = [];
          $.ajax({
            method: "GET",
            url:"/products-list",
            success:function(response){
               console.log("response")

            }
          });
     
   
    $( "#searchproducts" ).autocomplete({
      source: availableTags
    });
   
      </script>
      <script>
         function openNav() {
           document.getElementById("mySidenav").style.width = "250px";
         }
         
         function closeNav() {
           document.getElementById("mySidenav").style.width = "0";
         }
      </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
        <script src="{% static 'signup\vendor\jquery\jquery.min.js' %}"></script>
        <script src="{% static 'signup\js\main.js' %}"></script>




        <script>
        // change image in individual product page  while clicking
         function change_image(image){
            var container = document.getElementById("featured");
            container.src = image.src;
            var selectedcolor = document.getElementById("selectedcolor");
               selectedcolor.value= image.dataset.color;
         }
           // Select the first image in the thumbnail list by default
            window.addEventListener('DOMContentLoaded', function() {
               var thumbnailImages = document.querySelectorAll('.thumbnail');
               if (thumbnailImages.length > 0) {
               var firstImage = thumbnailImages[0];
               change_image(firstImage);
               }
            });


         // show correct price when user select a size
         function get_correct_prize(price,stock){
            var pricecontainer = document.getElementById("current_price");
            pricecontainer.textContent = price;
            
               var selectedprice = document.getElementById("selectedprice");
               selectedprice.value = price;
               if(stock < 1){
                  var stockMessage = document.getElementById('stockmessage')
                  stockMessage.textContent = "OUT OF STOCK"
                  var buttons_row = document.getElementById('buttons_row')
                  buttons_row.style.display = 'none'

               }
               else{
                  var stockMessage = document.getElementById('stockmessage')
                  stockMessage.textContent = "IN STOCK"
                  var buttons_row = document.getElementById('buttons_row')
                  buttons_row.style.display = 'block'
               }
           
            
            var selectedSizeInput = document.querySelector('input[name="size"]:checked');
               if (selectedSizeInput) {
               // var addToCartButton = document.getElementsByClassName("addToCartButton");
               // addToCartButton.dataset.size = selectedSizeInput.dataset.size;
               var selectedSize = document.getElementById("selectedsize")
               selectedSize.value = selectedSizeInput.dataset.size;
               }
         }


         // Function to increment the quantity
         function incrementQuantity(max) {
            var value = parseInt(document.getElementById('quantity').value, 10);
            value = isNaN(value) ? 0 : value;
            if( value < max){
               
               value++;

            }
            document.getElementById('quantity').value = value;
            var selectedquantityInput = document.getElementById("selectedquantity")
         selectedquantityInput.value = document.getElementById('quantity').value
         console.log(selectedquantityInput.value)
       }

       
       
         // Function to decrement the quantity
         function decrementQuantity() {
            var value = parseInt(document.getElementById('quantity').value, 10);
            value = isNaN(value) ? 0 : value;
            if (value > 1){
               value--;
            }
            
            document.getElementById('quantity').value = value;
           
       }
       
        
      //  add to cart button ajax
       $(".addToCartButton").on('click', function() {
            console.log("add to cart button clicked")
            
            var productid = document.getElementById("productid").value;
            var selectedcolor = document.getElementById("selectedcolor").value;
            var selectedsize = document.getElementById("selectedsize").value;
            var selectedprice = document.getElementById("selectedprice").value;
            // {% comment %} var selectedquantity = document.getElementById("quantity").value; {% endcomment %}

            if(!selectedsize || !selectedcolor){
               alert("Size and Color are Mandatory")
            }
            
          
            console.log(productid)

            data = {"productid" : productid,"selectedcolor":selectedcolor,"selectedsize":selectedsize,"selectedprice":selectedprice}

            $.ajax({
               url:"{% url 'add_to_cart' %}",
               method:"GET",
               data:data,

               success: function(data) {
                  console.log("code run success")
                  console.log(data.status)
                  console.log(data.message)
                  alert("Added to Cart")
                  // Get the button element
                  $(".addToCartButton").css("background-color", "blue");
               }
            })

         })
         document.addEventListener("DOMContentLoaded", function(event) {});
       
 </Script>




<script>
   $('.plus-btn').on('click', function() {
console.log("plus function working")
var cartItemId = $(this).data('id');
var action = $(this).data('action');
console.log(cartItemId)
updateCartItemQuantity(cartItemId, action);

});

$('.minus-btn').on('click', function() {
console.log("minus function working")
var cartItemId = $(this).data('id');
var action = $(this).data('action');
console.log(cartItemId)
updateCartItemQuantity(cartItemId, action);

});


function updateCartItemQuantity(cartItemId, action) {
		$.ajax({
		  url: "{% url 'update_cart_item_quantity' %}",
		  method: 'GET',
		  data: {
			cart_item_id: cartItemId,
			action: action
		  },
		  success: function(response) {
			if (response.status === 200) {
			  // Update the quantity value in the template
			  var quantitySpan = $('.value[data-id="' + cartItemId + '"] span');
           var totalItems = $('.total_items');
			  quantitySpan.text(response.quantity);
           totalItems.text(response.total_items);
           var priceSpan = $('.total_price');
	        priceSpan.text(response.total);
           
			  
			}
		  }
		});
	  }
	
  

</script>



<!-- default address selecting by user -->

<script>
   function submitForm() {
     
      console.log("entered")
  var f = document.getElementsByClassName("addressform")
  var checkboxs = document.getElementsByClassName("my_checkbox");
  var checkbox = checkboxs[0];
  console.log(checkbox)
  
  var inputValue = checkbox.checked ? "True" : "False";
  console.log(inputValue)
  checkbox.value = inputValue;
   
}

</script>
 





<!-- passing detials from check out page to place_order url -->
      
<script>
         // cash on delivery success message pop up
      function displayPopup(id,amount) {
            var overlay = document.getElementById("overlay");
            var popup = document.getElementById("popup");
            var cod_order_id = document.getElementById("cod_order_id");
            var cod_amount_to_be_paid = document.getElementById("cod_amount_to_be_paid");
            overlay.style.display = "block";
            popup.style.display = "block";
            cod_order_id.innerHTML = id;
            cod_amount_to_be_paid.innerHTML = amount;

          }
      

      //         function closePopup() {
      // var overlay = document.getElementById("overlay");
      // var popup = document.getElementById("popup");
      // overlay.style.display = "none";
      // popup.style.display = "none";
      //         }

   

   $(".proceed_button").on('click', function() {
      console.log("proceed button clicked")
      var dropdown = document.getElementById("myDropdown");
      var selectedOption = dropdown.options[dropdown.selectedIndex].value;

      var defaultAddressId = "{{ default_address.id }}";  // Retrieve the default address ID from the Django template variable

      if(!defaultAddressId){
         alert("Address is Mandatory")
      }
      if(!selectedOption){
         alert("Choose a Payment Method")
      }
      $.ajax({
        type: "GET",
        url: "{% url 'place_order' %}",  // Replace 'place_order' with the actual URL of your view
        data: {
          
          'defaultAddressId': defaultAddressId,
          'selectedOption':selectedOption,
         
        },
        success: function(data) {
                  console.log("code run success")
               
                  console.log(data.message)
                  if( data.flag===1){
                     displayPopup(data.id,data.amount)
                  }
                  if (data.redirect) {
                     // Redirect to the specified URL
                     window.location.href = data.redirect ;
                     
                  } else {
                     // Handle other response data
                     // ...
                     console.log("no redirect")
                  }
               }
        
        
      });
   })

</script>


<!-- wallet pay button ajx -->
<script>
      $(".wallet_pay").on('click', function() {
      console.log("wallet button clicked")
      
      var defaultAddressId = "{{ default_address.id }}";  // Retrieve the default address ID from the Django template variable

      if(!defaultAddressId){
         alert("Address is Mandatory")
      }
      
      $.ajax({
        type: "GET",
        url: "{% url 'wallet_pay' %}",  // Replace 'place_order' with the actual URL of your view
        data: {
          
          'defaultAddressId': defaultAddressId,
         
         
        },
        success: function(data) {
                  console.log("code run success")
               
                  console.log(data.message)
                  
                  if (data.redirect) {
                     // Redirect to the specified URL
                     window.location.href = data.redirect ;
                     
                  } else {
                     // Handle other response data
                     // ...
                     console.log("no redirect")
                  }
               }
        
        
      });
   })

</script>

<!-- coupon apply ajax -->
<script>
      $('#apply-coupon-button').click(function() {
      console.log("button clicked");
      var url = "{% url 'apply_coupon' %}";

      var coupon = $('#coupon').val();
      console.log(coupon);
      // var couponId = $('#coupon-id');
      // console.log(couponId);
     
      var totalPrice = parseInt($('.total_price').text().replace('â‚¹ ', ''));
      console.log(totalPrice);
     
      $.ajax({
        url: url,
        type: 'GET',
        
        data: {
         'coupon': coupon,
         'totalPrice':totalPrice
        },
        success: function(response) {
         console.log(response)
         if (response) {
           
           $('.total_price').text('â‚¹ ' + response.total);
           confirm(response['message'])
           const couponInput = document.getElementById('coupon');
           couponInput.value = '';
         }
        },
        error: function() {
         console.log('Error');
         confirm(response['message'])
        }
      });
     })
</script>
   </body>
</html>